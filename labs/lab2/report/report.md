---
## Front matter
title: "Лабораторная работа 2" 
subtitle: "Настройка DNS-сервера"
author: "Лушин Артём Андреевич"

## Generic otions
lang: ru-RU
toc-title: "Содержание"

## Bibliography
bibliography: bib/cite.bib
csl: pandoc/csl/gost-r-7-0-5-2008-numeric.csl

## Pdf output format
toc: true # Table of contents
toc-depth: 2
lof: true # List of figures
fontsize: 12pt
linestretch: 1.5
papersize: a4
documentclass: scrreprt
## I18n polyglossia
polyglossia-lang:
  name: russian
  options:
	- spelling=modern
	- babelshorthands=true
polyglossia-otherlangs:
  name: english
## I18n babel
babel-lang: russian
babel-otherlangs: english
## Fonts
mainfont: PT Serif
romanfont: PT Serif
sansfont: PT Sans
monofont: PT Mono
mainfontoptions: Ligatures=TeX
romanfontoptions: Ligatures=TeX
sansfontoptions: Ligatures=TeX,Scale=MatchLowercase
monofontoptions: Scale=MatchLowercase,Scale=0.9
## Biblatex
biblatex: false
biblio-style: "gost-numeric"
biblatexoptions:
  - parentracker=true
  - backend=biber
  - hyperref=auto
  - language=auto
  - autolang=other*
  - citestyle=gost-numeric
## Pandoc-crossref LaTeX customization
figureTitle: "Рис."
tableTitle: "Таблица"
listingTitle: "Листинг"
lofTitle: "Список иллюстраций"
lolTitle: "Листинги"
## Misc options
indent: true
header-includes:
  - \usepackage{indentfirst}
  - \usepackage{float} # keep figures where there are in the text
  - \floatplacement{figure}{H} # keep figures where there are in the text
---

# Цель работы

Приобретение практических навыков по установке и конфигурированию DNS-сервера, усвоение принципов работы системы доменных имён.

# Выполнение лабораторной работы

1) Я перешёл в каталог vagrant и запустил виртуальную машину server. 

![Запуск машины](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/1.jpg){#fig:001 width=70%}

2) Я перешёл в суперпользователя и установил bind и bind-utils.

![Установка ПО](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/2.jpg){#fig:002 width=70%}

3) Я сделал запрос с DNS-адресу Яндекса. Проанализируем строки вывода: 

- HEADER (заголовок): показывает версию dig, глобальные опции используемые с командой и другую дополнительную информацию

- QUESTION SECTION: Показывает наш запрос, то есть мы запросили показать A-запись (команда dig без параметров) для домена www.yandex.ru

- ANSWER SECTION: Показывает ответ полученный от DNS, в нашем случае показывает A-запись для www.yandex.ru Последняя секция это статистика по запросу (служебная информация)- время выполнения запроса (8 мс), имя DNS-сервера который запрашивался, когда был создан запрос и размер сообщения 

![Запрос с яндекс](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/3.jpg){#fig:003 width=70%}

4) С помощью утилиты проанализируем содержание файла /etc/resolv.conf. Cодержит имя сервера и его адрес Фотографии сделаны после выполнения лабораторной, поэтому содержание может отличаться от изначальных скриптов. 

![Анализ /etc/resolv.conf](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/40.jpg){#fig:004 width=70%}

5) С помощью утилиты проанализируем содержание файла /etc/named.conf. Фотографии сделаны после выполнения лабораторной, поэтому содержание может отличаться от изначальных скриптов. 

![Анализ /etc/named.conf](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/41.jpg){#fig:005 width=70%}

6) С помощью команды проанализируем содержание файла /var/named/named.ca.Фотографии сделаны после выполнения лабораторной, поэтому содержание может отличаться от изначальных скриптов. 

![Содержание /var/named/named.ca](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/42.jpg){#fig:006 width=70%}

7) С помощью команды проанализируем содержание файла /var/named/named.localhost. В данном файле есть следующие строки: запись начала полномочий, которая указывает начало зоны и включает имя хоста на которых находится файл данных. Запись сервера имён, идентифицирующая главный и подчинённый серверы DNS. Указаны IP адреса локального хоста. Фотографии сделаны после выполнения лабораторной, поэтому содержание может отличаться от изначальных скриптов. 

![Содержание ](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/43.jpg){#fig:007 width=70%}

8) С помощью утилиты проанализируем содержание файла /var/named/named.loopback. Данный файл практически полностью идентичен как и файл localhost, но добавляется PTR-запись для локального хоста. Фотографии сделаны после выполнения лабораторной, поэтому содержание может отличаться от изначальных скриптов. 

![Содержание /var/named/named.loopback](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/44.jpg){#fig:008 width=70%}

9) Я запустил DNS-сервер и включил автозапуск. 

![Запуск сервера](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/5.jpg){#fig:009 width=70%}

10) Сравним вывод информации после анализа www.yandex.ru и 127.0.0.1 www.yandex.ru. При указании запрашиваемого адреса в строке с адресом написан адрес, который указывали, а также куки и увеличилось время запроса.

![Сравнение яндекса и айпи яндекса](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/45.jpg){#fig:010 width=70%}

11) Я сделал dns-сервер по умолчанию для хоста сервер и внутренней виртуальной сети.

![Сервер по умолчанию](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/6.jpg){#fig:011 width=70%}

12) Сделал ту же операцию для соединения system eth0.

![System eth0](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/7.jpg){#fig:012 width=70%}

13) Перезапустили NetworkManager. 

![Перезапуск](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/8.jpg){#fig:013 width=70%}

14) Я настроил направление DNS-запросов от всех узлов внутренней сети, включая запросы от узла сервер, через узел сервер.

![Настройка днс-запросов](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/9.jpg){#fig:014 width=70%}

15) Внесли изменения в настройки межсетевого экрана узла сервер, разрешив работу с ДНС.

![Изменения межсетевого экрана](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/10.jpg){#fig:015 width=70%}

16) Убедился, что запросы идут через узел сервер, который прослушивает порт 53. 

![](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/11.jpg){#fig:016 width=70%}

17) Я перенаправил запросы DNS на конкретный сервер и сделал так, чтобы сервер поддерживал запросы. 

![Перенаправление запросов](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/13.jpg){#fig:017 width=70%}

18) Получил текущие список серверов.

![Список серверов](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/12.jpg){#fig:018 width=70%}

19) Скопировал описание днс-зоны, переместил и переименовал его. 

![Перенос днс-зоны](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/14.jpg){#fig:019 width=70%}

20) Включил файл описания днс-зоны в конфигурационный файл. 

![Внос в конфигурационный файл](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/15.jpg){#fig:020 width=70%}

21) Изменил файл днс-зоны, чтобы он корректно работал.

![Изменение файла днс-зоны](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/16.jpg){#fig:021 width=70%}

22) Создал каталоги для обратной fz и rz для файлов прямой и обратной зоны. 

![Создание файлов fz и rz](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/17.jpg){#fig:022 width=70%}

23) Скопировал шаблон для прямой днс-зоны и перенёс в каталог Fz.

![Файл прямой днс-зоны](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/18.jpg){#fig:023 width=70%}

24) Изменил скрипт файла прямой зоны, чтобы он корректно работал на моей машине. 

![Изменение прямой зоны](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/24.jpg){#fig:024 width=70%}

25) Скопировал шаблон обратной днс-зоны и перенёс его в каталог rz.

![Обратная днс-зоны](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/25.jpg){#fig:025 width=70%}

26) Изменил скрипт файла обратной зоны, чтобы он корректно работал.

![Изменение обратной зоны](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/26.jpg){#fig:026 width=70%}

27) Изменил права доступа к файлам в каталогах Etc/named u var/named, чтобы файл named мог с ними работать.

![Изменение прав](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/27.jpg){#fig:027 width=70%}

28) После изменений доступа в конфигурационных файлах корректно восстановили метки безопасности в Selinux. Проверил состояние переключателей. 

![Восстановление меток](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/28.jpg){#fig:028 width=70%}

29) Запустил во втором терминале расширенный лог системных сообщений и перезапустил днс-сервер. Проверил на наличие ошибок, ошибок нет.

![Проверка на наличие ошибок](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/29.jpg){#fig:029 width=70%}

30) При помощи утилиты получил описание днс-зоны. 

![Описание днс-зоны](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/30.jpg){#fig:030 width=70%}

31) При помощи утилиты host проанализировал корректность работы днс-сервера.

![Корректность работы сервера](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/31.jpg){#fig:031 width=70%}

32) Зашёл в каталог /vagrant/provision/server/, создал подкаталог dns в который поместил соответствующие подкаталоги и конфигурационные файлы.А так же создал исполняющий файл.

![размещение файлов на машине](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/32.jpg){#fig:032 width=70%}

33) Создание скрипта в исполняющем файле dns.

![Скрипт в исполняющем файле](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/33.jpg){#fig:033 width=70%}

34) Чтобы скрипт отрабатывал при запуске машины, внёс изменения в vagrantfile.

![Изменение vagrantfile](/home/aalushin/фдд/new2/study_2024-2025_admin/labs/lab2/report/image/34.jpg){#fig:034 width=70%}

# Вывод 

Я приобрёл практические навыки по установке и конфигурированию DNS-сервера, усвоил принцип работы системы доменных имён.

# Контрольные вопросы

1) Что такое DNS?

- Система доменных имён (Domain Name System, DNS) — распределённая система (распределённая база данных), ставящая в соответствие доменному имени хоста (компьютера или другого сетевого устройства) IP-адрес, и наоборот.

2) Каково назначение кэширующего DNS-сервера?

- Кэширующий DNS-сервер получает рекурсивные запросы от клиентов и выполняет их с помощью нерекурсивных запросов к авторитативным серверам.

3) Чем отличается прямая DNS-зона от обратной?

- Прямая DNS зона - зона хранения записей соответствия доменного имени ip адресу. Обратная DNS зона - зона хранения записей соответствия ip адреса доменному имени.

4) В каких каталогах и файлах располагаются настройки DNS-сервера? Кратко охарактеризуйте, за что они отвечают.

- В каталоге /etc хранится файл named.conf, в котором есть информация об опциях сервера, его разрешениях, настройках безопасности и подключены файлы зон. В каталоге /named хранится файл описания DNS-зон, также в каталоге /var/named хранится файл named.loopback, описывающий обратную зону, и файл named.localhost, описывающий прямую зону.

5) Что указывается в файле resolv.conf?

- В этом файле указывается имя сервера и его адрес.

6) Какие типы записи описания ресурсов есть в DNS и для чего они используются?

Основные типы ресурсных записей (Resource Records):

- A-запись — задает преобразование имени хоста в IP-адрес.

- MX-запись — определяет почтовый ретранслятор для доменного имени, т.е. узел, который обработает или передаст дальше почтовые сообщения, предназначенные адресату в указанном домене. При наличии нескольких MX-записей сначала происходит попытка доставить почту на ретранслятор с наименьшим приоритетом.

- NS-записи — определяют DNS-серверы, которые являются авторитативными для данной зоны.

- CNAME-запись — определяет отображение псевдонима в каноническое имя узла.

- SRV-запись — позволяет получить имя для искомой службы, а также протокол, по которому эта служба работает.

- TXT-запись — содержит общую текстовую информацию. Эти записи могут использоваться в любых целях, например, для указания месторасположения хоста.

- AAAA-запись — задает преобразование имени хоста в IPV6-адрес.

- SSHFP-запись — используется для хранения слепка ключей SSH в DNS.

7) Для чего используется домен in-addr.arpa? 

- Домен in-addr.arpa используется для всех сетей TCP/IP, основанным на адресации протокола Интернета 4 (IPv4).

8) Для чего нужен демон named?

- Демон named отвечает на запросы об именах машин и их IP-адресах. Если named не знает ответа на какой-либо запрос, он опрашивает другие серверы и помещает их ответы в кэш. Этот демон, кроме того, отвечает за выполнение зонных пересылок, обеспечивающих копирование данных между серверами одного домена. Запросы демона named используют протокол UDP и порт 53. Если объем ответов превышает 512 байтов, то для их доставки используется протокол TCP. В зонных пересылках между серверами также применяется протокол TCP.

9) В чём заключаются основные функции slave-сервера и master-сервера?

- Главный (master) — хранит и управляет ресурсными записями (описанием) доменной зоны. К главному серверу может быть подключено множество ведомых; ведомый (slave) — получает и хранит информацию о доменных зонах с главного сервера. На ведомом сервере невозможно изменить описание доменной зоны.

10) Какие параметры отвечают за время обновления зоны?

- SOA-запись (Start of Authority) — начальная запись зоны, которая указывает местоположение эталонной записи о домене. Она хранит параметр TTL – время, в течение которого информация будет кешироваться другими DNS-серверами. Также параметр Refresh – время (в секундах) ожидания ответа вторичного DNS перед запросом SOA-записи с первичных серверов. По истечении данного времени вторичный DNS обращается к первичному для получения копии текущей SOA-записи. Первичный DNS-сервер выполняет этот запрос. Вторичный DNS-сервер сравнивает полученный серийный номер зоны с имеющимся. Если они отличаются, то осуществляется запрос к первичному DNS-серверу на трансфер зоны. И Expire – время (в секундах), в течение которого вторичный DNS будет пытаться завершить синхронизацию зоны с первичным. Если это время истечет до того, как синхронизация закончится, то зона на вторичном DNS-сервере перестанет обслуживать запросы об этой зоне.

11) Как обеспечить защиту зоны от скачивания и просмотра?

Можно делать следующее для защиты данных DNS доменов с помощью DNSSEC:

- Подписывать зоны или удалить подпись в соответствии со спецификациями DNSSEC

- (Необязательно) Указывать индивидуальные настройки для создания ключей

- Получать уведомления

- Просматривать и копировать записи ресурсов DS

- Просматривать и копировать наборы записей ресурсов DNSKEY.

12) Какая запись RR применяется при создании почтовых серверов?

- Заппись MX (от англ. mail exchanger) — тип DNS-записи, предназначенный для маршрутизации электронной почты с использованием протокола SMTP.

13) Как протестировать работу сервера доменных имён?

- Для этого можно воспользоваться командой nslookup, которая позволяет получить информацию о DNS-записях для заданного домена или IP-адреса.

14) Как запустить, перезапустить или остановить какую-либо службу в системе?

- systemctl restart named - перезапустить DNS-сервер

- systemctl stop named - перезапустить DNS-сервер

- systemctl start named - перезапустить DNS-сервер

15) Как посмотреть отладочную информацию при запуске какого-либо сервиса или службы?

- В дополнительном терминале запуститm в режиме реального времени расширенный лог системных сообщений: journalctl -x -f

16) Где храниться отладочная информация по работе системы и служб? Как её посмотреть?

- Журналы службы находятся в директории “/var/log/” в виде обычных текстовых файлов.

17) Как посмотреть, какие файлы использует в своей работе тот или иной процесс? Приведите несколько примеров

- lsof – есокращение от LiSt of Open Files, утилита эта служит для вывода информации о том, какие файлы используются теми или иными процессами. В качестве примера могу привести 16 пункт моей лабораторной работы. Там мы используем команду grep.

18) Приведите несколько примеров по изменению сетевого соединения при помощи командного интерфейса nmcli.

- В качестве примера могу привести 11 и 12 пункты моей лабораторной.

19) Что такое SELinux?

- SELinux (англ. Security-Enhanced Linux — Linux с улучшенной безопасностью) — реализация системы принудительного контроля доступа, которая может работать параллельно с классической избирательной системой контроля доступа.

20) Что такое контекст (метка) SELinux?

- SELinux — это система принудительного управления доступом, что означает, что каждый процесс имеет метку (label). Каждый файл, каталог и системный объект так же имеют метки. Правила политики управляют доступом между промаркированными процессами и объектами.

- Контекст безопасности — это совокупность всех атрибутов, которые связаны с объектами и субъектами

21) Как восстановить контекст SELinux после внесения изменений в конфигурационные файлы? 

После изменения доступа к конфигурационным файлам named требуется корректно восстановить их метки в SELinux:

restorecon -vR /etc restorecon -vR /var/named

Для проверки состояния переключателей SELinux, относящихся к named, надо ввести:

getsebool -a | grep named

При необходимости дать named разрешение на запись в файлы DNS-зоны:

setsebool named_write_master_zones 1 setsebool -P named_write_master_zones 1

22) Как создать разрешающие правила политики SELinux из файлов журналов, содержащих сообщения о запрете операций?

- Чтобы создать необходимые политики:

1. Создайте новый файл с исходным кодом политики SELinux (.te файл). Данный файл определяет ограничения, относящиеся к описываемому модулю.

2. При необходимости отредактируйте сгенерированный исходный файл политики [module_name].te, а затем, используя утилиту checkmodule, создайте бинарное представление (.mod файл) исходного файла локальной политики.

3. Создайте устанавливаемый модуль политики (.pp файл) с помощью утилиты semodule_package.

4. Для установки созданного модуля политики воспользуйтесь утилитой semodule.

23) Что такое булевый переключатель в SELinux?

- Булевый переключатель в SELinux - это параметр, который управляет разрешениями безопасности на уровне SELinux. Он может быть включен (true) или выключен (false) и используется для разрешения или запрещения определенных действий.

24) Как посмотреть список переключателей SELinux и их состояние? 

- Для просмотра списка переключателей SELinux и их состояния можно использовать команду “semanage boolean -l” в терминале.

25) Как изменить значение переключателя SELinux?

- Чтобы изменить значение переключателя SELinux, можно использовать команду “setsebool”. Например, для включения переключателя с именем “httpd_can_network_connect” можно выполнить команду “setsebool -P httpd_can_network_connect 1”. Здесь -P указывает, что изменение должно быть постоянным (постоянно сохраняться после перезагрузки).
